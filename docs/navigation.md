# Navigation Structure

generated by:
`Analyze the navigation structure starting with ContentView and suggest a plan for a NavigationPath organisation of the App as a whole. Write it to navigation.md`
`Expand navigation.md with a table for deep linking paths for the full navigation in the app. Document both app specific scheme and web support via https://thepia.com/recordthing`

## Overview

The app uses a hybrid navigation system combining tab-based and sidebar-based navigation with a NavigationPath for deep linking and state management. The navigation is primarily driven by the `ContentView` which serves as the root container.

## Navigation Components

### Root Level (ContentView)
- Tab-based navigation with four main sections:
  1. Record (Camera/Evidence)
  2. Assets (Stack/Things)
  3. Actions (Account/Settings)
  4. Internal (Data/Admin)

### Navigation Path Structure


```swift
// Main navigation tabs
enum BrowseNavigationTab {
    case record
    case assets
    case actions
    case internalData // contains things, types, feed, favorites
}

// Navigation Path Segments
enum NavigationDestination {
    // Record Tab
    case record
    case recordCapture
    case recordReview(evidenceId: UUID)
    
    // Internal Tab Paths
    case internalData
    case internalThings
    case internalTypes
    case internalFeed
    case internalFavorites
    case internalDataBrowse(title: String, path: String)
    
    // Assets Tab Paths
    case assets
    case assetsGroup(groupId: String)
    case assetsDetail(assetId: UUID)
    case assetsThingDetail(thingId: UUID)
    case assetsEvidenceList(thingId: UUID)
    case assetsEvidenceDetail(thingId: UUID, evidenceId: UUID)
    
    // Actions Tab Paths
    case actions
    case actionsAccount
    case actionsSettings
    case actionsHelp
    
    // Helper computed property for tab identification
    var tab: BrowseNavigationTab {
        switch self {
        case .record, .recordCapture, .recordReview:
            return .record
        case .internalData, .internalThings, .internalTypes, .internalFeed, .internalFavorites, .internalDataBrowse:
            return .internal
        case .assets, .assetsGroup, .assetsDetail, .assetsThingDetail, .assetsEvidenceList, .assetsEvidenceDetail:
            return .assets
        case .actions, .actionsAccount, .actionsSettings, .actionsHelp:
            return .actions
        }
    }
}
```

## Navigation Flow

### Record Tab
1. Main Camera View (`NavigationDestination.record`)
   - Camera preview
   - Evidence capture controls
   - Evidence clarification UI
2. Evidence Capture (`NavigationDestination.recordCapture`)
   - Active capture mode
   - Camera controls
3. Evidence Review (`NavigationDestination.recordReview`)
   - Review captured evidence
   - Edit evidence details
   - Add additional evidence

### Internal Tab

ContentView.path determines how the Internal Data tab is rendered.

1. Things (`NavigationDestination.internalThings`)
   - List of recorded things
   - Thing details
   - Evidence associated with things
2. Types (`NavigationDestination.internalTypes`)
   - Evidence type categories
   - Type-specific views
3. Feed (`NavigationDestination.internalFeed`)
   - Activity feed
   - Recent updates
4. Favorites (`NavigationDestination.internalFavorites`)
   - Bookmarked items
   - Quick access
5. Data Browse (`NavigationDestination.internalDataBrowse`)
   - Internal data management
   - System configuration

### Assets Tab
1. Asset Groups (`NavigationDestination.assetsGroup`)
   - Categorized asset groups including recorded things
   - Search and filter
2. Asset Detail (`NavigationDestination.assetsDetail`)
   - Asset information
   - Usage history
   - Related evidence
3. Thing Detail (`NavigationDestination.assetsThingDetail`)
   - Thing information
   - Related evidence
4. Evidence List (`NavigationDestination.assetsEvidenceList`)
   - List of evidence for a thing
5. Evidence Detail (`NavigationDestination.assetsEvidenceDetail`)
   - Full evidence view
   - Evidence metadata
   - Related things
6. Thing showcase

### Actions Tab
1. Account (`NavigationDestination.actionsAccount`)
   - User profile
   - Preferences
2. Settings (`NavigationDestination.actionsSettings`)
   - App configuration
   - Camera settings
3. Help (`NavigationDestination.actionsHelp`)
   - Documentation
   - Support

## Implementation Details

### Navigation State Management
```swift
struct ContentView {
    @State private var path = NavigationPath()
    @State private var selectedTab: BrowseNavigationTab = .record
    
    // Navigation path handling
    private func handleNavigation(_ path: NavigationDestination) {
        // Update selected tab if needed
        if selectedTab != path.tab {
            selectedTab = path.tab
        }
        self.path.append(path)
    }
    
    // Tab switching
    private func switchTab(_ tab: BrowseNavigationTab) {
        selectedTab = tab
        // Clear or preserve path based on tab
        switch tab {
        case .record:
            path.removeLast(path.count)
        case .assets, .actions, .internal:
            // Preserve path for these tabs
            break
        }
    }
}
```

### Navigation Transitions
- Slide transitions between tabs
- Fade transitions for modal presentations
- Custom transitions for camera/evidence views
- Smooth transitions for internal data views

### Deep Linking Support
- Support for deep linking to specific evidence or things
- URL scheme: `recordthing://`
- Example: `recordthing://assets/123/evidence/456`

### Deep Linking Paths

| Path | App Scheme | Web URL | Description |
|------|------------|---------|-------------|
| **Record Tab** |
| Camera View | `recordthing://record` | `https://thepia.com/recordthing/record` | Main camera view |
| Evidence Capture | `recordthing://record/capture` | `https://thepia.com/recordthing/record/capture` | Active evidence capture |
| Evidence Review | `recordthing://record/review/{evidenceId}` | `https://thepia.com/recordthing/record/review/{evidenceId}` | Review specific evidence |
| **Assets Tab** |
| Asset Groups | `recordthing://assets` | `https://thepia.com/recordthing/assets` | List of asset groups |
| Asset Group | `recordthing://assets/{groupId}` | `https://thepia.com/recordthing/assets/{groupId}` | Specific asset group |
| Asset Detail | `recordthing://assets/{groupId}/{assetId}` | `https://thepia.com/recordthing/assets/{groupId}/{assetId}` | Details of specific asset |
| Thing Evidence | `recordthing://assets/{thingId}/evidence` | `https://thepia.com/recordthing/assets/{thingId}/evidence` | List of evidence for thing |
| Evidence Detail | `recordthing://assets/{thingId}/evidence/{evidenceId}` | `https://thepia.com/recordthing/assets/{thingId}/evidence/{evidenceId}` | Specific evidence for thing |
| **Actions Tab** |
| Account | `recordthing://actions/account` | `https://thepia.com/recordthing/actions/account` | User account settings |
| Settings | `recordthing://actions/settings` | `https://thepia.com/recordthing/actions/settings` | App settings |
| Help | `recordthing://actions/help` | `https://thepia.com/recordthing/actions/help` | Help documentation |
| **Internal Tab** |
| Things | `recordthing://internal/things` | `https://thepia.com/recordthing/internal/things` | List of recorded things |
| Types | `recordthing://internal/types` | `https://thepia.com/recordthing/internal/types` | Evidence type categories |
| Feed | `recordthing://internal/feed` | `https://thepia.com/recordthing/internal/feed` | Activity feed |
| Favorites | `recordthing://internal/favorites` | `https://thepia.com/recordthing/internal/favorites` | Bookmarked items |
| Data Browse | `recordthing://internal/data/{path}` | `https://thepia.com/recordthing/internal/data/{path}` | Internal data view |

#### URL Parameters

| Parameter | Type | Description | Example |
|-----------|------|-------------|---------|
| `groupId` | String | Identifier for asset group | `watches` |
| `assetId` | UUID | Unique identifier for an asset | `123e4567-e89b-12d3-a456-426614174002` |
| `evidenceId` | UUID | Unique identifier for evidence | `123e4567-e89b-12d3-a456-426614174001` |
| `mode` | String | Optional view mode (grid/list) | `grid` |
| `filter` | String | Optional filter parameter | `recent` |
| `sort` | String | Optional sort parameter | `date` |

#### Implementation Notes

1. **App Scheme Handling**
   ```swift
   // URL scheme registration in Info.plist
   <key>CFBundleURLTypes</key>
   <array>
       <dict>
           <key>CFBundleURLSchemes</key>
           <array>
               <string>recordthing</string>
           </array>
       </dict>
   </array>
   ```

2. **Universal Links Support**
   ```swift
   // Associated Domains capability
   <key>com.apple.developer.associated-domains</key>
   <array>
       <string>applinks:thepia.com</string>
   </array>
   ```

3. **URL Handling**
   ```swift
   // SceneDelegate or App entry point
   func scene(_ scene: UIScene, openURLContexts URLContexts: Set<UIOpenURLContext>) {
       guard let url = URLContexts.first?.url else { return }
       handleDeepLink(url)
   }
   ```

4. **Web Fallback**
   - All app-specific URLs redirect to corresponding web pages
   - Web pages include "Open in App" button when appropriate
   - Maintain consistent URL structure between app and web

5. **Security**
   - Validate all URL parameters
   - Sanitize user input in URLs
   - Implement proper authentication checks
   - Use HTTPS for all web URLs

## Best Practices

1. **State Preservation**
   - Preserve navigation state when switching tabs
   - Clear navigation stack when appropriate (e.g., starting new recording)

2. **Deep Linking**
   - Support deep linking to any major view
   - Handle invalid deep links gracefully
   - Maintain navigation state during deep link navigation

3. **Back Navigation**
   - Clear navigation stack when starting new recording
   - Preserve stack when reviewing evidence
   - Support gesture-based back navigation

4. **Modal Presentations**
   - Use sheets for temporary UI
   - Use full-screen covers for immersive experiences
   - Maintain proper navigation hierarchy

5. **Error Handling**
   - Handle navigation errors gracefully
   - Provide fallback navigation options
   - Clear invalid navigation states

## Future Considerations

1. **Navigation Analytics**
   - Track navigation patterns
   - Monitor deep link usage
   - Analyze user flow

2. **Accessibility**
   - Support VoiceOver navigation
   - Implement proper navigation announcements
   - Consider reduced motion preferences

3. **State Restoration**
   - Save navigation state for app restoration
   - Handle background/foreground transitions
   - Preserve user context

4. **Performance**
   - Lazy load views when possible
   - Optimize navigation transitions
   - Monitor memory usage during navigation 